<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KasirKyta Premium POS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        [x-cloak] { display: none !important; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .sidebar-item-active { background: #4f46e5; color: white; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        @media print { .no-print { display: none !important; } #receipt-print { display: block !important; } }
    </style>
</head>
<body class="bg-slate-50 text-slate-800" x-data="posSystem()" x-init="initApp()">

    <template x-if="currentPage === 'landing'">
        <div class="min-h-screen bg-[#0f172a] text-white flex flex-col items-center justify-center p-6">
            <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')] opacity-10"></div>
            <div class="relative z-10 text-center">
                <h1 class="text-6xl font-black tracking-tighter italic mb-4">Kasir<span class="text-indigo-500">Kyta</span></h1>
                <p class="text-slate-400 mb-8 max-w-md mx-auto">Solusi Point of Sale premium untuk efisiensi bisnis Anda dengan fitur keamanan PIN dan manajemen inventory lengkap.</p>
                <button @click="currentPage = 'login'" class="bg-indigo-600 hover:bg-indigo-500 px-10 py-4 rounded-2xl font-bold transition-all transform hover:scale-105 shadow-xl">MASUK KE SISTEM</button>
            </div>
        </div>
    </template>

    <template x-if="currentPage === 'login'">
        <div class="min-h-screen flex items-center justify-center bg-slate-100 p-6">
            <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full max-w-sm border border-slate-200">
                <h2 class="text-2xl font-black text-center mb-6">LOGIN</h2>
                <div class="space-y-4">
                    <input type="text" x-model="loginForm.user" placeholder="Username" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none focus:ring-2 focus:ring-indigo-500">
                    <input type="password" x-model="loginForm.pass" placeholder="Password" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none focus:ring-2 focus:ring-indigo-500">
                    <button @click="handleLogin" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg hover:bg-indigo-500 transition">MASUK</button>
                    <button @click="currentPage = 'landing'" class="w-full text-slate-400 text-xs font-bold uppercase tracking-widest">Kembali</button>
                </div>
            </div>
        </div>
    </template>

    <div x-show="isLoggedIn" x-cloak class="flex min-h-screen overflow-hidden">
        
        <aside class="w-20 md:w-64 bg-white border-r border-slate-200 flex flex-col no-print z-50">
            <div class="p-6 text-center md:text-left">
                <span class="text-xl font-black text-indigo-600 tracking-tighter">KK<span class="hidden md:inline text-slate-800">POS</span></span>
            </div>
            
            <nav class="flex-1 px-4 space-y-2">
                <template x-if="currentUser?.role !== 'kasir'">
                    <button @click="activeTab = 'dashboard'" :class="activeTab === 'dashboard' ? 'sidebar-item-active' : 'text-slate-500'" class="w-full flex items-center gap-4 p-4 rounded-2xl transition group">
                        <span>üìä</span> <span class="hidden md:inline font-bold text-sm">Dashboard</span>
                    </button>
                </template>

                <button @click="activeTab = 'kasir'" :class="activeTab === 'kasir' ? 'sidebar-item-active' : 'text-slate-500'" class="w-full flex items-center gap-4 p-4 rounded-2xl transition">
                    <span>üõí</span> <span class="hidden md:inline font-bold text-sm">Menu Kasir</span>
                </button>

                <template x-if="currentUser?.role !== 'kasir'">
                    <div class="space-y-2">
                        <button @click="activeTab = 'produk'" :class="activeTab === 'produk' ? 'sidebar-item-active' : 'text-slate-500'" class="w-full flex items-center gap-4 p-4 rounded-2xl transition">
                            <span>üì¶</span> <span class="hidden md:inline font-bold text-sm">Produk & Barcode</span>
                        </button>
                        <button @click="activeTab = 'history'" :class="activeTab === 'history' ? 'sidebar-item-active' : 'text-slate-500'" class="w-full flex items-center gap-4 p-4 rounded-2xl transition">
                            <span>üìú</span> <span class="hidden md:inline font-bold text-sm">Riwayat Transaksi</span>
                        </button>
                        <button @click="activeTab = 'users'" :class="activeTab === 'users' ? 'sidebar-item-active' : 'text-slate-500'" class="w-full flex items-center gap-4 p-4 rounded-2xl transition">
                            <span>üë•</span> <span class="hidden md:inline font-bold text-sm">Manajemen User</span>
                        </button>
                        <button @click="activeTab = 'toko'" :class="activeTab === 'toko' ? 'sidebar-item-active' : 'text-slate-500'" class="w-full flex items-center gap-4 p-4 rounded-2xl transition">
                            <span>üè¢</span> <span class="hidden md:inline font-bold text-sm">Info Toko</span>
                        </button>
                    </div>
                </template>
            </nav>

            <div class="p-4 border-t border-slate-100">
                <button @click="logout" class="w-full flex items-center gap-4 p-4 text-red-500 font-bold text-sm">
                    <span>üëã</span> <span class="hidden md:inline">Keluar</span>
                </button>
            </div>
        </aside>

        <main class="flex-1 h-screen overflow-y-auto bg-slate-50 p-4 md:p-8">
            
            <div x-show="activeTab === 'dashboard'" class="space-y-6">
                <h2 class="text-3xl font-black">Dashboard</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-indigo-600 p-8 rounded-[2.5rem] text-white shadow-xl">
                        <p class="text-xs font-bold uppercase opacity-80 mb-2">Omset Hari Ini</p>
                        <h3 class="text-3xl font-black" x-text="formatIDR(calculateDailyOmset())"></h3>
                    </div>
                    <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm">
                        <p class="text-xs font-bold uppercase text-slate-400 mb-2">Total Transaksi</p>
                        <h3 class="text-3xl font-black" x-text="currentStore.salesHistory.length"></h3>
                    </div>
                </div>
            </div>

            <div x-show="activeTab === 'kasir'" class="h-full flex flex-col gap-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-black text-slate-800">Point of Sale</h2>
                    <div class="text-right">
                        <p class="text-[10px] font-bold text-slate-400 uppercase" x-text="currentStore.storeName"></p>
                        <p class="text-xs font-black text-indigo-600" x-text="currentUser?.user"></p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1 min-h-0">
                    <div class="lg:col-span-7 flex flex-col gap-4">
                        <input type="text" x-model="searchQuery" placeholder="üîç Cari barang atau scan barcode..." class="w-full p-4 bg-white border border-slate-200 rounded-2xl shadow-sm outline-none focus:ring-2 focus:ring-indigo-500">
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-4 overflow-y-auto pr-2 custom-scrollbar">
                            <template x-for="p in filteredProducts" :key="p.id">
                                <div @click="addToCart(p)" class="bg-white p-4 rounded-3xl border border-slate-100 shadow-sm hover:shadow-md transition-all cursor-pointer group active:scale-95">
                                    <div class="aspect-square bg-slate-100 rounded-2xl mb-3 overflow-hidden">
                                        <img :src="p.image || 'https://via.placeholder.com/150'" class="w-full h-full object-cover">
                                    </div>
                                    <p class="font-bold text-sm line-clamp-1" x-text="p.name"></p>
                                    <p class="text-xs text-slate-400 mb-2" x-text="p.barcode"></p>
                                    <p class="font-black text-indigo-600" x-text="formatIDR(p.price)"></p>
                                </div>
                            </template>
                        </div>
                    </div>

                    <div class="lg:col-span-5 bg-white rounded-[2.5rem] shadow-xl border border-slate-200 flex flex-col overflow-hidden">
                        <div class="p-6 border-b border-slate-100 flex justify-between items-center">
                            <h3 class="font-bold">Keranjang</h3>
                            <span class="bg-indigo-100 text-indigo-600 px-3 py-1 rounded-full text-xs font-black" x-text="cart.length + ' Item'"></span>
                        </div>
                        
                        <div class="flex-1 overflow-y-auto p-6 space-y-4">
                            <template x-if="cart.length === 0">
                                <div class="text-center py-10 opacity-20">üõí Keranjang Kosong</div>
                            </template>
                            <template x-for="(item, index) in cart" :key="index">
                                <div class="flex justify-between items-center bg-slate-50 p-4 rounded-2xl group">
                                    <div class="flex-1">
                                        <p class="font-bold text-sm" x-text="item.name"></p>
                                        <p class="text-[10px] text-indigo-600 font-bold" x-text="item.qty + ' x ' + formatIDR(item.price)"></p>
                                    </div>
                                    <div class="flex items-center gap-4">
                                        <p class="font-black text-sm" x-text="formatIDR(item.price * item.qty)"></p>
                                        <button @click="removeFromCart(index)" class="text-red-400 hover:text-red-600 text-lg">‚úï</button>
                                    </div>
                                </div>
                            </template>
                        </div>

                        <div class="p-6 bg-slate-50 space-y-3">
                            <div class="flex justify-between text-xs font-bold text-slate-400"><span>TOTAL</span> <span class="text-2xl font-black text-slate-800" x-text="formatIDR(calculateFinalTotal())"></span></div>
                            <button @click="openPayment" :disabled="cart.length === 0" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-lg disabled:opacity-50">BAYAR SEKARANG</button>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="activeTab === 'produk'" class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-black">Produk & Barcode</h2>
                    <button @click="showAddProduct = true" class="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-bold">+ Tambah</button>
                </div>

                <div class="bg-white rounded-[2.5rem] shadow-sm border border-slate-200 overflow-hidden">
                    <table class="w-full text-left border-collapse">
                        <thead class="bg-slate-50 text-slate-400 text-[10px] font-bold uppercase tracking-widest">
                            <tr>
                                <th class="p-6">Produk</th>
                                <th class="p-6">Barcode / Kode</th>
                                <th class="p-6">Harga</th>
                                <th class="p-6">Stok</th>
                                <th class="p-6">Aksi</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-100">
                            <template x-for="p in currentStore.products" :key="p.id">
                                <tr class="hover:bg-slate-50 transition">
                                    <td class="p-6 flex items-center gap-3">
                                        <div class="w-10 h-10 bg-slate-100 rounded-lg overflow-hidden">
                                            <img :src="p.image || 'https://via.placeholder.com/50'" class="w-full h-full object-cover">
                                        </div>
                                        <span class="font-bold text-sm" x-text="p.name"></span>
                                    </td>
                                    <td class="p-6">
                                        <span class="bg-slate-100 px-3 py-1 rounded-full text-[10px] font-mono font-bold" x-text="p.barcode"></span>
                                    </td>
                                    <td class="p-6 font-bold text-sm" x-text="formatIDR(p.price)"></td>
                                    <td class="p-6 font-bold text-sm" x-text="p.stock"></td>
                                    <td class="p-6">
                                        <button @click="deleteProduct(p.id)" class="text-red-400 hover:text-red-600">Hapus</button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>

            <div x-show="activeTab === 'history'" class="space-y-6">
                <h2 class="text-3xl font-black">Riwayat Transaksi</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <template x-for="sale in [...currentStore.salesHistory].reverse()">
                        <div @click="viewDetail(sale)" class="bg-white p-6 rounded-[2rem] border border-slate-200 shadow-sm cursor-pointer hover:border-indigo-500 transition-all">
                            <div class="flex justify-between items-start mb-4">
                                <span class="bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-[10px] font-bold" x-text="sale.trxId"></span>
                                <span class="text-[10px] text-slate-400" x-text="formatDate(sale.date)"></span>
                            </div>
                            <p class="font-black text-xl mb-1" x-text="formatIDR(sale.amount)"></p>
                            <p class="text-xs text-slate-400">Kasir: <span class="text-slate-800 font-bold" x-text="sale.cashier"></span></p>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="activeTab === 'users'" class="space-y-6">
                <div class="flex justify-between items-center">
                    <h2 class="text-3xl font-black">Manajemen User</h2>
                    <button @click="showAddUser = true" class="bg-indigo-600 text-white px-6 py-3 rounded-2xl font-bold">+ User Baru</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <template x-for="u in users">
                        <div class="bg-white p-6 rounded-[2rem] border border-slate-200 flex items-center justify-between">
                            <div>
                                <p class="font-black text-lg" x-text="u.user"></p>
                                <p class="text-[10px] font-bold uppercase text-indigo-500" x-text="u.role"></p>
                            </div>
                            <button @click="deleteUser(u.user)" class="text-red-400 hover:text-red-600">‚úï</button>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="activeTab === 'toko'" class="space-y-6 max-w-2xl mx-auto">
                <h2 class="text-3xl font-black">Info Toko</h2>
                <div class="bg-white p-8 rounded-[2.5rem] border border-slate-200 shadow-sm space-y-4">
                    <div><label class="text-[10px] font-bold text-slate-400 uppercase">Nama Toko</label><input type="text" x-model="currentStore.storeName" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none"></div>
                    <div><label class="text-[10px] font-bold text-slate-400 uppercase">Alamat</label><textarea x-model="currentStore.address" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none"></textarea></div>
                    <div><label class="text-[10px] font-bold text-slate-400 uppercase">No. Telepon</label><input type="text" x-model="currentStore.phone" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none"></div>
                    <div><label class="text-[10px] font-bold text-slate-400 uppercase">PIN Otoritas Supervisor</label><input type="password" x-model="currentStore.pin" class="w-full p-4 bg-slate-50 rounded-2xl border-none outline-none" placeholder="Default: 1234"></div>
                    <button @click="saveStoreData" class="w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold">SIMPAN PERUBAHAN</button>
                </div>
            </div>

        </main>
    </div>

    <div x-show="showPaymentModal" x-cloak class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-[100] flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-8 shadow-2xl">
            <h3 class="text-xl font-black text-center mb-6">Pembayaran</h3>
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button @click="paymentMethod = 'Tunai'" :class="paymentMethod === 'Tunai' ? 'bg-indigo-600 text-white' : 'bg-slate-100'" class="py-4 rounded-2xl font-bold">Tunai</button>
                <button @click="paymentMethod = 'Non-Tunai'" :class="paymentMethod === 'Non-Tunai' ? 'bg-indigo-600 text-white' : 'bg-slate-100'" class="py-4 rounded-2xl font-bold">Non-Tunai</button>
            </div>
            
            <div x-show="paymentMethod === 'Tunai'" class="mb-6">
                <input type="number" x-model="cashReceived" placeholder="Uang Diterima" class="w-full p-4 bg-slate-50 rounded-2xl text-xl font-black mb-2">
                <div class="flex justify-between font-bold text-emerald-600"><span>Kembali:</span> <span x-text="formatIDR(calculateChange())"></span></div>
            </div>

            <div x-show="paymentMethod === 'Non-Tunai'" class="mb-6">
                <input type="text" x-model="paymentRef" placeholder="No. Referensi" class="w-full p-4 bg-slate-50 rounded-2xl font-bold">
            </div>

            <button @click="processPayment" class="w-full py-4 bg-slate-900 text-white rounded-2xl font-bold shadow-lg">SELESAI</button>
            <button @click="showPaymentModal = false" class="w-full text-slate-400 mt-4 text-xs font-bold uppercase tracking-widest">Batal</button>
        </div>
    </div>

    <div x-show="showAddProduct" x-cloak class="fixed inset-0 bg-slate-900/60 z-[100] flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-md rounded-[2.5rem] p-8">
            <h3 class="text-xl font-black mb-6">Tambah Produk</h3>
            <div class="space-y-4">
                <input type="text" x-model="newP.name" placeholder="Nama Produk" class="w-full p-4 bg-slate-50 rounded-2xl">
                <input type="text" x-model="newP.barcode" placeholder="Barcode / Kode Barang" class="w-full p-4 bg-slate-50 rounded-2xl">
                <div class="grid grid-cols-2 gap-4">
                    <input type="number" x-model="newP.price" placeholder="Harga" class="w-full p-4 bg-slate-50 rounded-2xl">
                    <input type="number" x-model="newP.stock" placeholder="Stok" class="w-full p-4 bg-slate-50 rounded-2xl">
                </div>
                <input type="text" x-model="newP.image" placeholder="Link Foto Produk" class="w-full p-4 bg-slate-50 rounded-2xl">
                <div class="flex gap-2">
                    <button @click="addProduct" class="flex-1 bg-indigo-600 text-white py-4 rounded-2xl font-bold">SIMPAN</button>
                    <button @click="showAddProduct = false" class="flex-1 bg-slate-100 py-4 rounded-2xl font-bold">BATAL</button>
                </div>
            </div>
        </div>
    </div>

    <div x-show="showDetailModal" x-cloak class="fixed inset-0 bg-black/60 z-[110] flex items-center justify-center p-6">
        <div class="bg-white w-full max-w-sm rounded-[3rem] p-8">
            <h3 class="font-black text-center text-xl mb-4">Detail TRX</h3>
            <div class="space-y-2 mb-6">
                <template x-for="item in selectedSale?.items">
                    <div class="flex justify-between text-sm">
                        <span x-text="item.name + ' (x' + item.qty + ')'"></span>
                        <span class="font-bold" x-text="formatIDR(item.price * item.qty)"></span>
                    </div>
                </template>
                <div class="border-t pt-2 mt-4 space-y-1">
                    <div class="flex justify-between font-black"><span>Total</span> <span x-text="formatIDR(selectedSale?.amount)"></span></div>
                    <div class="flex justify-between text-xs text-slate-400"><span>Metode</span> <span x-text="selectedSale?.method"></span></div>
                    <div class="flex justify-between text-xs text-slate-400"><span>Kasir</span> <span x-text="selectedSale?.cashier"></span></div>
                </div>
            </div>
            <button @click="showDetailModal = false" class="w-full py-4 bg-slate-100 rounded-2xl font-bold">TUTUP</button>
        </div>
    </div>

    <script>
        function posSystem() {
            return {
                currentPage: 'landing', isLoggedIn: false, activeTab: 'dashboard', currentUser: null,
                searchQuery: '', showAddProduct: false, showPaymentModal: false, showAddUser: false,
                showDetailModal: false, selectedSale: null,
                cart: [], paymentMethod: 'Tunai', cashReceived: 0, paymentRef: '',
                users: [], loginForm: {user: '', pass: ''},
                newP: {name: '', price: '', stock: '', image: '', barcode: ''},
                currentStore: {
                    storeName: 'KasirKyta Store', address: 'Jl. Contoh No. 123', phone: '08123456789',
                    products: [], salesHistory: [], pin: '1234'
                },

                initApp() {
                    const savedUsers = localStorage.getItem('kk_users');
                    this.users = savedUsers ? JSON.parse(savedUsers) : [
                        {user: 'owner', pass: 'owner', role: 'owner'},
                        {user: 'admin', pass: 'admin', role: 'admin'},
                        {user: 'kasir', pass: 'kasir', role: 'kasir'}
                    ];
                    const savedStore = localStorage.getItem('kk_store_data');
                    if(savedStore) this.currentStore = JSON.parse(savedStore);
                },

                handleLogin() {
                    const u = this.users.find(u => u.user === this.loginForm.user && u.pass === this.loginForm.pass);
                    if(u) {
                        this.currentUser = u; this.isLoggedIn = true;
                        this.activeTab = u.role === 'kasir' ? 'kasir' : 'dashboard';
                    } else alert('Login Gagal!');
                },

                logout() { location.reload(); },

                saveStoreData() {
                    localStorage.setItem('kk_store_data', JSON.stringify(this.currentStore));
                    alert('Data Disimpan!');
                },

                addProduct() {
                    if(!this.newP.name || !this.newP.price) return;
                    this.currentStore.products.push({ id: Date.now(), ...this.newP });
                    this.saveStoreData();
                    this.showAddProduct = false;
                    this.newP = {name: '', price: '', stock: '', image: '', barcode: ''};
                },

                deleteProduct(id) {
                    if(confirm('Hapus produk?')) {
                        this.currentStore.products = this.currentStore.products.filter(p => p.id !== id);
                        this.saveStoreData();
                    }
                },

                addToCart(p) {
                    let item = this.cart.find(i => i.id === p.id);
                    if(item) item.qty++;
                    else this.cart.push({...p, qty: 1});
                },

                removeFromCart(index) {
                    if(this.currentUser.role === 'kasir') {
                        const pin = prompt('Butuh Otoritas Supervisor (PIN):');
                        if(pin !== this.currentStore.pin) return alert('PIN Salah!');
                    }
                    this.cart.splice(index, 1);
                },

                openPayment() { this.showPaymentModal = true; },

                processPayment() {
                    const total = this.calculateFinalTotal();
                    const sale = {
                        trxId: 'TRX#' + Math.floor(Math.random()*100000),
                        date: new Date().toISOString(),
                        amount: total,
                        items: [...this.cart],
                        method: this.paymentMethod,
                        cashier: this.currentUser.user
                    };
                    this.currentStore.salesHistory.push(sale);
                    this.saveStoreData();
                    alert('Transaksi Berhasil!');
                    this.cart = []; this.showPaymentModal = false;
                },

                get filteredProducts() {
                    if(!this.searchQuery) return this.currentStore.products;
                    const q = this.searchQuery.toLowerCase();
                    return this.currentStore.products.filter(p => p.name.toLowerCase().includes(q) || p.barcode.toLowerCase().includes(q));
                },

                calculateDailyOmset() {
                    const today = new Date().toDateString();
                    return this.currentStore.salesHistory
                        .filter(s => new Date(s.date).toDateString() === today)
                        .reduce((t, s) => t + s.amount, 0);
                },

                calculateFinalTotal() { return this.cart.reduce((t, i) => t + (i.price * i.qty), 0); },
                calculateChange() { return this.cashReceived - this.calculateFinalTotal(); },
                formatIDR(n) { return 'Rp ' + new Intl.NumberFormat('id-ID').format(n); },
                formatDate(d) { return new Date(d).toLocaleString('id-ID'); },
                viewDetail(s) { this.selectedSale = s; this.showDetailModal = true; }
            }
        }
    </script>
</body>
</html>
