<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini POS - Cloud Ready</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        @media print {
            body * { visibility: hidden; }
            #receipt, #receipt * { visibility: visible; }
            #receipt { position: absolute; left: 0; top: 0; width: 100%; }
        }
    </style>
</head>
<body class="bg-slate-100 font-sans" x-data="posApp()">

    <nav class="bg-indigo-700 text-white p-4 shadow-md flex justify-between items-center">
        <h1 class="font-black text-xl tracking-tighter">GEMINI POS <span class="text-xs font-normal opacity-70">v3.0</span></h1>
        <div class="flex items-center gap-4">
            <button @click="showAdmin = !showAdmin" class="bg-indigo-800 px-3 py-1 rounded text-sm hover:bg-indigo-900">‚öôÔ∏è Admin Panel</button>
        </div>
    </nav>

    <div class="container mx-auto p-4 grid grid-cols-12 gap-6">
        
        <div x-show="showAdmin" class="col-span-12 bg-white p-6 rounded-2xl shadow-sm border-l-4 border-orange-500 mb-4">
            <h2 class="font-bold text-gray-700 mb-4 flex justify-between">
                Konfigurasi Admin
                <button @click="showAdmin = false" class="text-gray-400">‚úï</button>
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="space-y-2">
                    <label class="text-xs font-bold text-gray-500 uppercase">Set PIN Admin (untuk hapus item)</label>
                    <input type="password" x-model="adminPin" class="w-full border p-2 rounded" placeholder="Contoh: 1234">
                </div>
                <div class="md:col-span-2 grid grid-cols-2 gap-2">
                    <input type="text" x-model="newP.name" placeholder="Nama Barang" class="border p-2 rounded">
                    <input type="number" x-model="newP.price" placeholder="Harga" class="border p-2 rounded">
                    <input type="number" x-model="newP.stock" placeholder="Stok" class="border p-2 rounded">
                    <button @click="addProduct()" class="bg-indigo-600 text-white font-bold rounded">Tambah Produk</button>
                </div>
            </div>
        </div>

        <div class="col-span-12 md:col-span-8 bg-white p-6 rounded-2xl shadow-sm h-[70vh] overflow-y-auto">
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                <template x-for="p in products" :key="p.id">
                    <div @click="addToCart(p)" class="cursor-pointer group border p-3 rounded-xl hover:shadow-md transition bg-slate-50 relative">
                        <div class="h-20 bg-slate-200 rounded-lg flex items-center justify-center mb-2 font-bold text-slate-400">üì¶</div>
                        <h3 x-text="p.name" class="font-bold text-sm truncate"></h3>
                        <p x-text="formatIDR(p.price)" class="text-indigo-600 font-bold text-xs"></p>
                        <span x-text="'Stok: '+p.stock" class="text-[10px] text-gray-400 uppercase"></span>
                    </div>
                </template>
            </div>
        </div>

        <div class="col-span-12 md:col-span-4 bg-white p-6 rounded-2xl shadow-xl border-t-8 border-indigo-600">
            <h2 class="font-bold border-b pb-2 mb-4">üõí Billing</h2>
            
            <div class="space-y-3 h-60 overflow-y-auto pr-2">
                <template x-for="(item, index) in cart" :key="index">
                    <div class="flex justify-between items-center group">
                        <div class="flex items-center gap-2">
                            <button @click="removeItem(index)" class="text-red-400 opacity-0 group-hover:opacity-100 text-xs">‚úï</button>
                            <div>
                                <p x-text="item.name" class="text-sm font-bold"></p>
                                <p class="text-[10px] text-gray-500" x-text="item.qty + ' x ' + formatIDR(item.price)"></p>
                            </div>
                        </div>
                        <span x-text="formatIDR(item.price * item.qty)" class="font-bold text-sm"></span>
                    </div>
                </template>
            </div>

            <div class="mt-4 border-t pt-4 space-y-1 text-sm text-gray-600 font-medium">
                <div class="flex justify-between italic">
                    <span>Subtotal:</span>
                    <span x-text="formatIDR(subtotal())"></span>
                </div>
                <div class="flex justify-between items-center text-red-500">
                    <span>Diskon (%)</span>
                    <input type="number" x-model="discountPercent" class="w-12 border rounded text-right px-1">
                </div>
                <div class="flex justify-between items-center text-blue-500">
                    <span>Pajak (%)</span>
                    <input type="number" x-model="taxPercent" class="w-12 border rounded text-right px-1">
                </div>
                <div class="flex justify-between text-xl font-black text-indigo-700 mt-2 border-t pt-2">
                    <span>TOTAL</span>
                    <span x-text="formatIDR(finalTotal())"></span>
                </div>
            </div>

            <button @click="checkout()" class="w-full bg-indigo-600 text-white py-4 rounded-xl font-bold mt-4 shadow-lg active:scale-95 transition">CETAK & BAYAR</button>
        </div>
    </div>

    <div id="receipt" class="hidden p-4 font-mono text-xs w-64 bg-white">
        <center>
            <h2 class="font-bold text-base uppercase">Toko Gemini</h2>
            <p>Admin: Gemini Kasir</p>
            <p>--------------------------</p>
        </center>
        <template x-for="item in cart">
            <div class="flex justify-between">
                <span x-text="item.name + ' x' + item.qty"></span>
                <span x-text="formatIDR(item.price * item.qty)"></span>
            </div>
        </template>
        <p>--------------------------</p>
        <div class="flex justify-between"><span>Subtotal:</span><span x-text="formatIDR(subtotal())"></span></div>
        <div class="flex justify-between"><span>Diskon:</span><span x-text="discountPercent + '%'"></span></div>
        <div class="flex justify-between"><span>Pajak (PPN):</span><span x-text="taxPercent + '%'"></span></div>
        <div class="flex justify-between font-bold text-sm"><span>TOTAL:</span><span x-text="formatIDR(finalTotal())"></span></div>
        <center class="mt-4 italic">*** Terima Kasih ***</center>
    </div>

    <script>
        function posApp() {
            return {
                showAdmin: false,
                adminPin: '1234', // PIN Default
                products: JSON.parse(localStorage.getItem('products')) || [],
                cart: [],
                newP: { name: '', price: '', stock: '' },
                discountPercent: 0,
                taxPercent: 10, // Default PPN 10%

                addProduct() {
                    if(!this.newP.name || !this.newP.price) return;
                    this.products.push({ id: Date.now(), ...this.newP, price: parseInt(this.newP.price), stock: parseInt(this.newP.stock) });
                    this.save();
                    this.newP = { name: '', price: '', stock: '' };
                },

                addToCart(p) {
                    if(p.stock <= 0) return alert('Stok Habis!');
                    let found = this.cart.find(i => i.id === p.id);
                    if(found) found.qty++; else this.cart.push({...p, qty: 1});
                },

                removeItem(index) {
                    let inputPin = prompt("Masukkan PIN Admin untuk membatalkan/menghapus produk:");
                    if(inputPin === this.adminPin) {
                        this.cart.splice(index, 1);
                    } else {
                        alert("PIN SALAH! Tindakan dibatalkan.");
                    }
                },

                subtotal() { return this.cart.reduce((t, i) => t + (i.price * i.qty), 0); },
                
                finalTotal() {
                    let sub = this.subtotal();
                    let disc = sub * (this.discountPercent / 100);
                    let afterDisc = sub - disc;
                    let tax = afterDisc * (this.taxPercent / 100);
                    return afterDisc + tax;
                },

                checkout() {
                    if(this.cart.length === 0) return;
                    // Potong Stok
                    this.cart.forEach(item => {
                        let p = this.products.find(prod => prod.id === item.id);
                        if(p) p.stock -= item.qty;
                    });
                    this.save();
                    setTimeout(() => { window.print(); this.cart = []; }, 500);
                },

                save() { localStorage.setItem('products', JSON.stringify(this.products)); },
                formatIDR(n) { return 'Rp ' + new Intl.NumberFormat('id-ID').format(n); }
            }
        }
    </script>
</body>
</html>
